<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Eventos</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
        .section { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 8px; background: #fdfdfd; }
        h2 { margin-top: 0; color: #333; border-bottom: 2px solid #ddd; padding-bottom: 5px;}
        
        .form-row { display: flex; gap: 10px; align-items: flex-end; }
        .form-group { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: bold;}
        input, select { width: 100%; padding: 8px; box-sizing: border-box; }
        
        /* Estilos para los checkboxes */
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-top: 10px; padding: 10px; background: #eee; }
        .checkbox-item { background: white; padding: 5px; border: 1px solid #ccc; }
        .checkbox-item input { width: auto; margin-right: 5px; }

        button { padding: 10px 20px; cursor: pointer; color: white; border: none; border-radius: 4px;}
        .btn-evento { background: #e0a800; }
        .btn-trabajador { background: #28a745; }
        .btn-generar { background: #007bff; width: 100%; font-size: 1.5em; margin-top: 20px; padding: 15px;}
    </style>
</head>
<body>
    <h1>Gestor de Personal Semanal</h1>
    
    <div class="section">
        <h2>1. Crear Eventos de la Semana</h2>
        <form action="/agregar_evento" method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label>Nombre del Evento:</label>
                    <select name="nombre">
                    <option value="Eventos">Eventos</option>
                    <option value="Posada">Posada</option>
                </select>
                </div>
                
                <div class="form-group">
                    <label>Fecha del Evento:</label>
                    <input type="date" name="fecha" required>
                </div>

                <div class="form-group">
                    <label>Hora de Entrada (Típica):</label>
                    <select id="selectorHora" name="hora_inicio" onchange="verificarHorarioPersonalizado(this)">
                        <option value="07:30">Mañana (7:30 AM)</option>
                        <option value="09:30">Mañana (9:30 AM)</option>
                        <option value="13:30" selected>Tarde (1:30 PM)</option>
                        <option value="14:00">Tarde (2:00 PM)</option>
                        <option value="17:30">Noche (5:30 PM)</option>
                        <option value="18:00">Noche (6:00 PM)</option>
                        <option value="custom">Otro horario...</option>
                    </select>
                    
                    <input type="time" id="inputHoraManual" style="display:none; margin-top:5px;" onchange="actualizarHoraManual(this)">
                </div>

                <button type="submit" class="btn-evento">➕ Agregar</button>
            </div>
        </form>
        
        {% if eventos %}
            <div style="margin-top: 15px;">
                <strong>Eventos activos:</strong>
                <ul>
                    {% for e in eventos %}
                        <li>{{ e.nombre }} - {{ e.inicio | fecha_es }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
    </div>

    <div class="section">
        <h2>2. Registrar Trabajador y Disponibilidad</h2>
        <form action="/agregar_trabajador" method="POST">
            <div class="form-row">
                <div class="form-group">
                    <label>Nombre:</label>
                    <input type="text" name="nombre" required placeholder="Ej: Jesús">
                </div>
                <div class="form-group">
                <label>Rol:</label>
                <select name="rol">
                    <option value="normal">STAFF - $150</option>
                    <option value="aux_cocina">Aux. Cocina - $200</option>
                    <option value="sup_cocina">Sup. Cocina - $250</option>
                    <option value="sup_evento">Sup. Evento - $250</option>
                </select>
            </div>
                <div class="form-group">
    <label>Cupo deseado (Automático):</label>
    <input type="number" name="cupo" id="inputCupo" value="0" min="0" readonly style="background-color: #eaeaea; cursor: not-allowed;">
</div>
            </div>

            <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                <label style="margin:0;">Selecciona los eventos a los que PUEDE asistir:</label>
                <div>
                    <button type="button" onclick="marcarTodos(true)" style="background:#6c757d; padding: 5px 10px; font-size: 0.8em;">✅ Todos</button>
                    <button type="button" onclick="marcarTodos(false)" style="background:#dc3545; padding: 5px 10px; font-size: 0.8em;">❌ Ninguno</button>
                </div>
            </div>

            <div class="checkbox-group">
                {% if eventos|length == 0 %}
                    <p style="color:red; font-style:italic;">Primero crea eventos arriba para verlos aquí.</p>
                {% else %}
                    {% for evento in eventos %}
                    <div class="checkbox-item">
                        <input type="checkbox" name="eventos_disponibles" value="{{ evento.id }}" onchange="actualizarConteo()">
                        {{ evento.nombre }} <br>
                        <small>{{ evento.inicio | fecha_es }}</small>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>

            <button type="submit" class="btn-trabajador" style="margin-top:10px; width:100%">➕ Guardar Trabajador</button>
        </form>

        <details style="margin-top: 10px;">
            <summary>Ver lista de trabajadores ingresados ({{ trabajadores|length }})</summary>
            <ul>
                {% for t in trabajadores %}
                    <li>{{ t.nombre }} - Puede ir a {{ t.ids_eventos_disponibles|length }} eventos</li>
                {% endfor %}
            </ul>
        </details>
    </div>

    <a href="/generar_horario">
        <button class="btn-generar">Generar Horario</button>
    </a>
    <script>
        function verificarHorarioPersonalizado(selectObj) {
        var inputManual = document.getElementById('inputHoraManual');
        if (selectObj.value === 'custom') {
            inputManual.style.display = 'block';
            inputManual.required = true;
            inputManual.name = "hora_inicio";
            selectObj.name = "";
        } else {
            inputManual.style.display = 'none';
            inputManual.required = false;
            selectObj.name = "hora_inicio";
        }
        }

        function actualizarHoraManual(inputObj) {
    }


        function actualizarConteo() {
        var checkboxes = document.getElementsByName('eventos_disponibles');
        var contados = 0;

        for(var i=0; i < checkboxes.length; i++) {
            if(checkboxes[i].checked) {
                contados++;
            }
        }

        document.getElementById('inputCupo').value = contados;
    }

        function marcarTodos(estado) {
        var checkboxes = document.getElementsByName('eventos_disponibles');
        
        for(var i=0; i<checkboxes.length; i++) {
            checkboxes[i].checked = estado;
        }
        actualizarConteo();
    }
    
    window.onload = function() {
        actualizarConteo();
    };
    </script>
</body>

</html>
